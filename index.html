<!-- 
    Technical English Reading Comprehension & Vocabulary Test
    Focus: Live Group Voting, Session-based Votes, Kid-Friendly Design, Interactive Particles.
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Awesome Website Quiz!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Particle Canvas Styling */
        #particle-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; /* Keep it in the background */
        }
        
        /* Body/Background Update (Vibrant Gradient) */
        body { 
            font-family: 'Inter', sans-serif; 
            /* New vibrant gradient: Purple to Green */
            background-image: linear-gradient(135deg, #a78bfa 0%, #34d399 100%); 
            display: flex;
            justify-content: center;
            align-items: flex-start; 
            min-height: 100vh;
            padding: 20px; 
            position: relative;
            overflow-x: hidden; 
            overflow-y: auto; 
        }
        
        /* Glass Container (More opaque for readability) */
        .glass-container {
            background: rgba(255, 255, 255, 0.95); /* Nearly solid white for text clarity */
            backdrop-filter: blur(5px); 
            -webkit-backdrop-filter: blur(5px);
            border-radius: 30px; /* More rounded */
            border: 3px solid rgba(255, 255, 255, 0.7);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2); /* Stronger shadow */
            padding: 2.5rem; 
            max-width: 95%;
            width: 750px; 
            margin-top: 20px; 
            margin-bottom: 20px;
            z-index: 10;
        }

        /* Passage and Question Cards (Clean White for Text) */
        .passage-box, .reference-text {
            background: #ffffff; 
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 2px solid #e5e7eb;
            font-size: 1.25rem; /* Bigger text */
            line-height: 1.6;
            color: #1f2937;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* Choice Buttons - Fun and Pop Effect */
        .choice-button {
            background: #ffffff;
            color: #4b5563;
            font-weight: 700; 
            padding: 1.2rem 1.5rem;
            border-radius: 15px; 
            border: 3px solid #60a5fa; /* Blue border */
            width: 100%;
            text-align: left;
            transition: all 0.1s;
            box-shadow: 0 5px 0 0 #3b82f6; /* 3D effect */
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            font-size: 1.1rem;
        }
        .choice-button:hover:not(:disabled) {
            background: #e0f2fe; /* Light blue on hover */
            border-color: #3b82f6;
            transform: translateY(2px); /* Push down */
            box-shadow: 0 3px 0 0 #3b82f6; 
        }
        .choice-button:active:not(:disabled) {
            transform: translateY(5px);
            box-shadow: none; /* Press effect */
        }

        /* Action Buttons (Next/Lock In) - Vibrant Colors */
        #action-btn {
            background-image: linear-gradient(to right, #f87171, #ef4444) !important; /* Red/Pink gradient */
            box-shadow: 0 5px 0 0 #dc2626;
            font-size: 1.5rem;
        }
        #action-btn:active {
            transform: translateY(3px);
            box-shadow: none;
        }
        #lock-in-btn {
            background-color: #10b981 !important; /* Green */
            box-shadow: 0 5px 0 0 #059669 !important;
            font-size: 1.5rem !important;
        }
        #lock-in-btn:active {
            transform: translateY(3px);
            box-shadow: none !important;
        }


        /* Feedback Styling */
        .correct-choice { 
            background-color: #34d399 !important; /* Brighter Green */
            color: white !important;
            border-color: #059669 !important;
            box-shadow: 0 5px 0 0 #059669 !important;
            transform: none !important; /* Reset transforms */
        } 
        .wrong-choice { 
            background-color: #f87171 !important; /* Brighter Red */
            color: white !important; 
            border-color: #dc2626 !important;
            box-shadow: 0 5px 0 0 #dc2626 !important;
            transform: none !important; /* Reset transforms */
        }
        .public-vote-star {
            font-weight: 900; 
            color: #fcd34d; /* Bright Yellow star */
            font-size: 1rem;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        .vote-details {
            display: flex;
            align-items: center;
        }
        .vote-count {
            font-size: 1rem;
            font-weight: 800;
            color: #6b7280;
        }
        .correct-choice .vote-count, .wrong-choice .vote-count {
            color: white; /* Light text on colored buttons */
        }
        .score-box {
            background: rgba(255, 255, 255, 0.9);
            border: 3px solid #e5e7eb;
        }

    </style>
</head>
<body>
    <!-- Background Particle Canvas -->
    <canvas id="particle-canvas"></canvas>

    <div class="glass-container">
        <h1 class="text-4xl font-black text-center text-gray-800 mb-6">ðŸ’» Awesome Website Quiz! ðŸš€</h1>

        <!-- Main Content Area - Everything is rendered here -->
        <div id="quiz-content">
            <!-- Content will be injected by JavaScript -->
        </div>

        <!-- Navigation/Action Button -->
        <div class="mt-8">
            <button id="action-btn" onclick="nextStep()" class="w-full py-3 text-xl font-bold text-white rounded-xl shadow-lg transition duration-300" style="display: none;">
                Next
            </button>
        </div>
    </div>

    <script>
        // --- DATA SETUP (Omitted for brevity, remains the same) ---
        const passages = [
            { id: 1, title: "Passage 1: The Browser and the Homepage", text: "Every day, Maria wants to watch a video. First, she opens her browser program. This is the application she uses for the internet. She looks at the top of the screen where the Address Bar is. In this space, she must type the full URL of the website. For example, she types `www.videozone.com`. After she presses 'Enter,' the website starts to load. The first screen she sees is the Homepage. This is the main page where she can start her search. Maria always starts here because it is fast. When the whole website loads, she is ready to begin." },
            { id: 2, title: "Passage 2: Finding Information", text: "Juan needs to find a recipe for pizza. He types the word 'pizza' into the Search Bar. He clicks the 'Search' button. The page loads quickly, but it is very long! Juan does not see the recipe immediately, so he must scroll down the page with his mouse wheel. He keeps scrolling and then sees many small pictures. These are icons for different videos and recipes. He sees one that looks delicious. He clicks the link next to the picture. He now opens a new page that has the recipe. The new page loads, and he is ready to cook." },
            { id: 3, title: "Passage 3: Giving Instructions", text: "My name is Alex. I am a web developer. I give simple instructions to my computer. To start, I always say: \"Open the browser!\" When the page is on the screen, I see a small picture of a pencil. This is the 'Edit' icon. I need to change some text, so I tell the user: \"Click the pencil icon to start editing.\" If the user makes a mistake, I shout, \"Do not click the red 'Delete' button!\" I often say, \"Scroll up to see the menu.\" After all the work is finished, the final command is: \"Close the page and the browser.\"" },
            { id: 4, title: "Passage 4: Website Actions in Detail", text: "When David uses the internet, he performs many actions. He sometimes types a long URL into the Address Bar, but sometimes he uses the Search Bar. When he types a word, the search results appear. Every result is a link. He clicks the best link. The page usually loads fast. If he is on a long page, he always scrolls down with his finger or mouse. His favorite game website has a huge green button to start the game. David clicks that button and the game loads. He never forgets to close his browser when he finishes playing." }
        ];

        const allQuestions = [
            { id: 1, q: "1. What is the name of the program Maria opens first?", options: ["The Link", "Her browser", "The Address Bar", "The Homepage"], correct: 1, passage: 1 },
            { id: 2, q: "2. Where on the screen is the Address Bar?", options: ["At the bottom", "In the center", "At the top of the screen", "Next to the Homepage"], correct: 2, passage: 1 },
            { id: 3, q: "3. What does Maria type into the Address Bar?", options: ["A game title", "A password", "The full URL", "Her name"], correct: 2, passage: 1 },
            { id: 4, q: "4. What is the Homepage?", options: ["The Address Bar", "The last page she visits", "The first, main page of a website", "The Browser application"], correct: 2, passage: 1 },
            { id: 5, q: "5. Why does Maria always start on the Homepage?", options: ["Because it is new", "Because it is fast", "Because it has videos", "Because she must scroll"], correct: 1, passage: 1 },
            { id: 6, q: "6. Complete the sentence correctly: The website _________ fast. (Load)", options: ["load", "loads", "is load", "loading"], correct: 1, passage: 1 },
            { id: 7, q: "7. Which word is the full address of a website (abbreviation)?", options: ["CPU", "RAM", "URL", "ICON"], correct: 2, passage: 1 },
            { id: 8, q: "8. Find the verb in the text that means to put information into a computer using a keyboard.", options: ["open", "load", "scroll", "type"], correct: 3, passage: 1 },
            { id: 9, q: "9. If Maria is ready to start, has the website finished the action of loading?", options: ["No, it is still loading.", "Yes, it has loaded.", "Maybe, she needs to click.", "She closes the browser."], correct: 1, passage: 1 },
            { id: 10, q: "10. True or False: Maria's browser is an application.", options: ["True", "False", "Not mentioned", "Only for games"], correct: 0, passage: 1 },
            { id: 11, q: "11. What word does Juan type into the Search Bar?", options: ["Recipe", "Pizza", "Cook", "Juan"], correct: 1, passage: 2 },
            { id: 12, q: "12. Why does Juan need to scroll down the page?", options: ["The button is big.", "The page is very long.", "To see the Address Bar.", "To close the browser."], correct: 1, passage: 2 },
            { id: 13, q: "13. What is next to the delicious picture that Juan clicks?", options: ["An icon", "A button", "A search bar", "A link"], correct: 3, passage: 2 },
            { id: 14, q: "14. What does the word link mean in this passage?", options: ["A picture", "A website address", "Text that opens a new page", "The search bar"], correct: 2, passage: 2 },
            { id: 15, q: "15. What are the small pictures for?", options: ["Addresses and URLs", "Recipes and videos", "Buttons and scroll bars", "Only for pizza"], correct: 1, passage: 2 },
            { id: 16, q: "16. Correct the verb form: Juan load the new page. (Load)", options: ["load", "loading", "loads", "loaded"], correct: 2, passage: 2 },
            { id: 17, q: "17. Which verb means to move the page up or down?", options: ["type", "open", "scroll", "load"], correct: 2, passage: 2 },
            { id: 18, q: "18. True or False: The page loaded quickly.", options: ["True", "False, it was slow.", "False, Juan scrolled a lot.", "Not mentioned"], correct: 0, passage: 2 },
            { id: 19, q: "19. What does Juan click to start the search after typing?", options: ["The new page", "The homepage", "The 'Search' button", "The URL"], correct: 2, passage: 2 },
            { id: 20, q: "20. What is the final action Juan does before cooking?", options: ["He closes the page.", "He scrolls up.", "He types the recipe.", "The new page loads."], correct: 3, passage: 2 },
            { id: 21, q: "21. What is Alex's job?", options: ["A cook", "A teacher", "A web developer", "A driver"], correct: 2, passage: 3 },
            { id: 22, q: "22. What is the first instruction Alex gives to his computer?", options: ["Type the URL!", "Click the icon!", "Open the browser!", "Close the page!"], correct: 2, passage: 3 },
            { id: 23, q: "23. What does the pencil icon mean?", options: ["Save", "Delete", "Edit", "Open"], correct: 2, passage: 3 },
            { id: 24, q: "24. What color is the button Alex says Do not click?", options: ["Blue", "Green", "Yellow", "Red"], correct: 3, passage: 3 },
            { id: 25, q: "25. What is the final command to finish the work?", options: ["Close the page and the browser.", "Scroll up!", "Type the address!", "Click the pencil icon."], correct: 0, passage: 3 },
            { id: 26, q: "26. Identify the verb form used for the positive instructions (e.g., Click the icon!).", options: ["Past Tense", "Base Verb (Imperative)", "Future Tense", "Verb + -s"], correct: 1, passage: 3 },
            { id: 27, q: "27. What is the name for the small picture used to represent 'Edit'?", options: ["A button", "An icon", "A link", "A bar"], correct: 1, passage: 3 },
            { id: 28, q: "28. Which is the correct negative instruction?", options: ["Do not scrolls up!", "Does not scroll up!", "Do not scroll up!", "Not scroll up!"], correct: 2, passage: 3 },
            { id: 29, q: "29. If the user wants to see the menu, what instruction does Alex give?", options: ["Type 'Menu'!", "Scroll up!", "Click the delete button!", "Load the page!"], correct: 1, passage: 3 },
            { id: 30, q: "30. What kind of element is the 'Delete' red?", options: ["An icon", "A link", "A button", "An address"], correct: 2, passage: 3 },
            { id: 31, q: "31. What are the two ways David finds a website?", options: ["Address Bar and Scroll Bar", "Search Bar and Button", "Address Bar and Search Bar", "URL and Homepage"], correct: 2, passage: 4 },
            { id: 32, q: "32. What is every search result called in the text?", options: ["A button", "A link", "An icon", "A browser"], correct: 1, passage: 4 },
            { id: 33, q: "33. What color and size is the game button?", options: ["Huge and red", "Small and blue", "Huge and green", "Small and white"], correct: 2, passage: 4 },
            { id: 34, q: "34. True or False: David uses his keyboard to scroll down a long page.", options: ["True, he types a code.", "False, he uses his finger or mouse.", "True, he clicks the keyboard.", "Not mentioned in the text."], correct: 1, passage: 4 },
            { id: 35, q: "35. What does David always remember to do when he finishes playing?", options: ["To scroll up.", "To type his name.", "To close his browser.", "To open a new page."], correct: 2, passage: 4 },
            { id: 36, q: "36. Complete the sentence: David always scrolls down with his finger or his _________.", options: ["eye", "keyboard", "mouse", "link"], correct: 2, passage: 4 },
            { id: 37, q: "37. Which two verbs in the passage use the 'He/She/It' -s rule?", options: ["type and click", "open and close", "scrolls and clicks", "load and type"], correct: 2, passage: 4 },
            { id: 38, q: "38. What is the full address of a website (abbreviation)?", options: ["GPS", "HTTP", "URL", "PDF"], correct: 2, passage: 4 },
            { id: 39, q: "39. What action happens after David clicks the button?", options: ["The URL types.", "The browser opens.", "The game loads.", "The link closes."], correct: 2, passage: 4 },
            { id: 40, q: "40. The word types is a verb. What is the base form of this verb?", options: ["type", "typing", "typed", "typess"], correct: 0, passage: 4 }
        ];

        // --- STATE MANAGEMENT (Omitted for brevity, remains the same) ---
        let state = {
            currentPassageIndex: 0,
            currentQuestionIndex: -1,
            userAnswers: {}, 
            localVotes: {}, 
            isFinished: false
        };

        const quizContent = document.getElementById('quiz-content');
        const actionButton = document.getElementById('action-btn');

        // Initialize localVotes structure
        allQuestions.forEach(q => {
            state.localVotes[q.id] = { 0: 0, 1: 0, 2: 0, 3: 0 };
        });

        // --- CORE QUIZ FUNCTIONS (Omitted for brevity, remains the same) ---
        function getQuestionsForCurrentPassage() {
            const passageId = state.currentPassageIndex + 1;
            return allQuestions.filter(q => q.passage === passageId);
        }

        function handleAnswer(qId, selectedIndex) {
            if (state.userAnswers[qId] !== undefined) { 
                return;
            }
            state.localVotes[qId][selectedIndex]++;
            render(); 
        }

        function lockInVote(qId) {
            const currentQVotes = state.localVotes[qId];
            let maxVoteCount = -1;
            let maxVoteIndex = -1;
            for (let i = 0; i < 4; i++) {
                const count = currentQVotes[i] || 0;
                if (count > maxVoteCount) {
                    maxVoteCount = count;
                    maxVoteIndex = i;
                }
            }
            state.userAnswers[qId] = maxVoteIndex;
            render();
        }

        function render() {
            if (state.isFinished) {
                showFinalScore();
                return;
            }

            const currentPassage = passages[state.currentPassageIndex];

            if (state.currentQuestionIndex === -1) {
                // RENDER PASSAGE VIEW
                quizContent.innerHTML = `
                    <h2 class="text-3xl font-bold text-gray-700 mb-4">${currentPassage.title}</h2>
                    <div class="passage-box italic text-gray-600">
                        ${currentPassage.text}
                    </div>
                    <p class="text-center text-lg font-medium text-gray-600 mt-4">This section has questions ${currentPassage.id * 10 - 9} to ${currentPassage.id * 10}.</p>
                `;
                actionButton.style.display = 'block';
                actionButton.textContent = `Start Questions for ${currentPassage.title}`;
            } else {
                // RENDER QUESTION VIEW
                const passageQuestions = getQuestionsForCurrentPassage();
                const currentQ = passageQuestions[state.currentQuestionIndex];
                
                if (!currentQ) {
                    nextStep();
                    return;
                }
                
                const qId = currentQ.id;
                const currentQVotes = state.localVotes[qId] || { 0: 0, 1: 0, 2: 0, 3: 0 };
                let maxVoteCount = -1;
                let maxVoteIndex = -1; 

                for (let i = 0; i < 4; i++) {
                    const count = currentQVotes[i] || 0;
                    if (count > maxVoteCount) {
                        maxVoteCount = count;
                        maxVoteIndex = i;
                    }
                }

                const isVoted = state.userAnswers[qId] !== undefined;
                const groupAnswerIndex = state.userAnswers[qId];
                
                let optionsHtml = currentQ.options.map((option, index) => {
                    const isCorrect = currentQ.correct === index;
                    const isMajorityChoice = index === maxVoteIndex;
                    
                    let classes = 'choice-button mb-3';
                    let starHtml = '';
                    const count = currentQVotes[index] || 0;
                    let voteText = `<span class="vote-count">(${count} votes)</span>`;
                    
                    if (isVoted) {
                        classes += ' pointer-events-none '; 
                        
                        if (isCorrect) {
                            classes += ' correct-choice';
                        } else if (index === groupAnswerIndex && !isCorrect) {
                            classes += ' wrong-choice';
                        }

                        if (index === groupAnswerIndex) {
                            starHtml = `<span class="public-vote-star"> (${isCorrect ? 'Correct Group Answer' : 'Group Answer'})</span>`;
                        }

                    } else {
                        if (isMajorityChoice && maxVoteCount > 0) {
                            starHtml = `<span class="public-vote-star"> (CHOICE)</span>`;
                        }
                    }

                    return `
                        <button 
                            class="${classes}" 
                            data-option-index="${index}" 
                            onclick="handleAnswer(${qId}, ${index})"
                            ${isVoted ? 'disabled' : ''}
                        >
                            <span>${option}</span>
                            <span class="vote-details">
                                ${voteText} ${starHtml}
                            </span>
                        </button>
                    `;
                }).join('');

                let questionControlsHtml = '';
                if (isVoted) {
                    actionButton.style.display = 'block';
                    actionButton.textContent = 'Next Question';
                } else {
                    actionButton.style.display = 'none';
                    questionControlsHtml = `
                        <div class="mt-8">
                            <button id="lock-in-btn" onclick="lockInVote(${qId})" class="w-full py-3 text-lg font-bold text-white rounded-xl shadow-lg transition duration-300 bg-green-600 hover:bg-green-700">
                                LOCK IN GROUP VOTE!
                            </button>
                            <p class="text-sm text-center text-gray-500 mt-2 font-medium">Click an option repeatedly to count student votes first, then click the Lock In button.</p>
                        </div>
                    `;
                }


                quizContent.innerHTML = `
                    <!-- Reference Passage -->
                    <h3 class="text-2xl font-bold text-gray-700 mb-3">Passage Reference:</h3>
                    <div class="reference-text italic text-gray-600">
                        ${currentPassage.text}
                    </div>

                    <!-- Question and Options -->
                    <div class="mb-4 text-center text-lg font-bold text-gray-600">Question ${currentQ.id} of 40</div>
                    <div class="passage-box p-4">
                        <p class="text-2xl font-extrabold mb-4">${currentQ.q}</p>
                        <div class="space-y-4">
                            ${optionsHtml}
                        </div>
                        ${questionControlsHtml}
                    </div>
                `;
            }
        }

        function nextStep() {
            const passageQuestions = getQuestionsForCurrentPassage();
            
            if (state.currentQuestionIndex === -1) {
                state.currentQuestionIndex = 0; 
            } 
            else if (state.currentQuestionIndex < passageQuestions.length - 1) {
                state.currentQuestionIndex++; 
            } 
            else if (state.currentPassageIndex < passages.length - 1) {
                state.currentPassageIndex++; 
                state.currentQuestionIndex = -1; 
            } 
            else {
                state.isFinished = true;
            }

            render();
            document.querySelector('.glass-container').scrollIntoView({ behavior: 'smooth' });
        }

        function showFinalScore() {
            let score = 0;
            allQuestions.forEach(q => {
                if (state.userAnswers.hasOwnProperty(q.id) && state.userAnswers[q.id] === q.correct) {
                    score++;
                }
            });

            quizContent.innerHTML = `
                <div class="score-box p-8 rounded-3xl text-center shadow-2xl">
                    <h2 class="text-4xl font-black text-green-600 mb-4">Quiz Complete! ðŸŽ‰</h2>
                    <p class="text-6xl font-black text-indigo-700 mb-8">${score} / 40</p>
                    <p class="text-2xl text-gray-700 font-semibold">The group's final score is ${score} out of 40!</p>
                    <p class="text-lg text-gray-500 mt-4">Great teamwork! Reload the page to start a new quiz session.</p>
                </div>
            `;
            actionButton.style.display = 'none'; 
        }
        
        
        // --- INTERACTIVE PARTICLE EFFECT LOGIC (New Swarm System) ---
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        // Fixed the variable declaration issue with 'var'
        var W, H; 
        
        // Mouse/Interaction state
        let mouse = { x: null, y: null, radius: 100 };

        function resizeCanvas() {
            W = window.innerWidth;
            H = window.innerHeight;
            canvas.width = W;
            canvas.height = H;
        }
        
        // Listen for mouse movement to update the interaction point
        canvas.addEventListener('mousemove', function(event) {
            mouse.x = event.x;
            mouse.y = event.y + window.scrollY;
        });

        // Hide mouse interaction when pointer leaves the window
        canvas.addEventListener('mouseleave', function() {
            mouse.x = null;
            mouse.y = null;
        });


        class Particle {
            constructor() {
                this.x = Math.random() * W;
                this.y = Math.random() * H;
                this.radius = 2 + Math.random() * 2;
                this.vx = (Math.random() - 0.5) * 1; // Velocity X
                this.vy = (Math.random() - 0.5) * 1; // Velocity Y

                // Use the light background colors for the particles
                const colors = ['#fde047', '#34d399', '#f97316', '#a78bfa'];
                this.color = colors[Math.floor(Math.random() * colors.length)];
            }

            draw() {
                ctx.globalAlpha = 0.8;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
            }

            update() {
                // Check boundaries and reverse velocity
                if (this.x < 0 || this.x > W) this.vx *= -1;
                if (this.y < 0 || this.y > H) this.vy *= -1;

                this.x += this.vx;
                this.y += this.vy;
            }

            // Method to repel particles from the mouse
            interact() {
                if (mouse.x === null || mouse.y === null) return;

                const dx = this.x - mouse.x;
                const dy = this.y - mouse.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                if (distance < mouse.radius) {
                    const forceDirectionX = dx / distance;
                    const forceDirectionY = dy / distance;
                    
                    // Force is stronger when closer, but limited to prevent instability
                    const maxForce = 5; 
                    const force = Math.min(maxForce, (mouse.radius - distance) / mouse.radius); 

                    // Apply repulsion force to velocity
                    this.vx += forceDirectionX * force * 0.5;
                    this.vy += forceDirectionY * force * 0.5;

                    // Limit velocity to prevent particles from flying off too fast
                    const maxSpeed = 3;
                    this.vx = Math.min(Math.max(this.vx, -maxSpeed), maxSpeed);
                    this.vy = Math.min(Math.max(this.vy, -maxSpeed), maxSpeed);
                }
            }
        }

        function initParticles() {
            particles = [];
            // Use slightly more particles for the connecting effect
            const particleCount = Math.floor((W * H) / 12000); 
            for (let i = 0; i < particleCount; i++) {
                particles.push(new Particle());
            }
        }

        function connectParticles() {
            let maxDistance = 90; // Only connect particles within this distance

            for (let a = 0; a < particles.length; a++) {
                for (let b = a; b < particles.length; b++) {
                    const dx = particles[a].x - particles[b].x;
                    const dy = particles[a].y - particles[b].y;
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    if (distance < maxDistance) {
                        // Calculate opacity based on distance (closer = more opaque)
                        const opacity = 1 - (distance / maxDistance);
                        
                        ctx.strokeStyle = `rgba(255, 255, 255, ${opacity * 0.2})`; // Faint white lines
                        ctx.lineWidth = 1;
                        ctx.beginPath();
                        ctx.moveTo(particles[a].x, particles[a].y);
                        ctx.lineTo(particles[b].x, particles[b].y);
                        ctx.stroke();
                    }
                }
            }
        }

        function animateParticles() {
            requestAnimationFrame(animateParticles);
            // Clear the canvas fully with a transparent/faint color for a clean look
            ctx.fillStyle = 'rgba(167, 139, 250, 0.2)'; 
            ctx.fillRect(0, 0, W, H);
            
            connectParticles();

            particles.forEach(p => {
                p.interact();
                p.update();
                p.draw();
            });
        }

        window.addEventListener('resize', () => {
            resizeCanvas();
            initParticles(); 
        });

        // Initial setup
        resizeCanvas();
        initParticles();
        animateParticles();
        
        // Initialize the quiz
        window.onload = render;
    </script>
</body>
</html>
